<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel del Owner - Hor G Cargo Express</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(to right, #4CAF50, #B266FF);
  color: #222;
  text-align: center;
  padding: 20px;
}
h2 {
  color: white;
  text-shadow: 1px 1px 3px #333;
}
input, button {
  padding: 10px;
  margin: 5px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}
button {
  background: #4CAF50;
  color: white;
  cursor: pointer;
}
button:hover {
  background: #45a049;
}
table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  background: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
}
th {
  background: #B266FF;
  color: white;
  padding: 10px;
}
td {
  padding: 8px;
  text-align: center;
  border-bottom: 1px solid #ddd;
}
</style>
</head>
<body>

<h2>Resumen del Owner (conectado a Google Sheets)</h2>

<div>
  <label>Mes:</label>
  <input type="text" id="mes" placeholder="Ej: Octubre">
  <label>Semana:</label>
  <input type="text" id="semana" placeholder="Ej: 1">
  <label>Driver:</label>
  <input type="text" id="driver" placeholder="Ej: Driver 1">
  <button onclick="filtrarDatos()">Filtrar</button>
  <button onclick="limpiar()">Limpiar</button>
</div>

<table id="tabla"></table>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQJNoOMFPAB8M-UhmKHG1rWxJvHaumF1k012pKyTkUSq2XC5blEQXkNxvAcyfKvayVPjoLjhUGMRA8p/pub?gid=2092876240&single=true&output=csv";
let datos = [];

Papa.parse(CSV_URL, {
  download: true,
  header: true,
  complete: function(results) {
    // Normalizamos los encabezados para que no fallen por mayÃºsculas o espacios
    datos = results.data.map(row => {
      const nuevo = {};
      for (const key in row) {
        const limpio = key.toString().trim().toLowerCase();
        nuevo[limpio] = (row[key] || "").toString().trim();
      }
      return nuevo;
    });
    renderTable(datos);
  }
});

function renderTable(rows) {
  const tabla = document.getElementById("tabla");
  if (!rows.length) {
    tabla.innerHTML = "<tr><td>No hay datos para mostrar</td></tr>";
    return;
  }

  const headers = Object.keys(rows[0]);
  tabla.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
  rows.forEach(r => {
    tabla.innerHTML += "<tr>" + headers.map(h => `<td>${r[h] ?? ""}</td>`).join("") + "</tr>";
  });
}

function filtrarDatos() {
  const mes = document.getElementById("mes").value.trim().toLowerCase();
  const semana = document.getElementById("semana").value.trim().toLowerCase();
  const chofer = document.getElementById("driver").value.trim();

  const filtrado = datos.filter(r => {
    const mesVal = (r["mes"] ?? "").toLowerCase();
    const semanaVal = (r["semana"] ?? "").toLowerCase();
    const choferVal = (r["chofer"] ?? "");

    const condMes = !mes || mesVal === mes;
    const condSemana = !semana || semanaVal === semana;
    const condChofer = !chofer || parseInt(choferVal) === parseInt(chofer);

    return condMes && condSemana && condChofer;
  });

  renderTable(filtrado);
}

function limpiar() {
  document.getElementById("mes").value = "";
  document.getElementById("semana").value = "";
  document.getElementById("driver").value = "";
  renderTable(datos);
}
</script>



</body>
</html>

